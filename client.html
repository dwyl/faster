<img src="http://www.randomkittengenerator.com/images/cats/rotator.php" />

<div id="fstr__"><a id="fstr_refresh__" title="automatic page refresh"></a><span id="fstr_msg__">hai</span> </div>

<style>
  #fstr__, #fstr_refresh__, #fstr_msg__{
    font-family:Courier New, monospace;
    display: block;
    /*background: url(http://i.imgur.com/Cp0ITNX.png);*/
    position: fixed;
    bottom: 0px;
    left: 0px;
    z-index: 100;
    background-color: white;
    width: 100%;
    height: 15px;
    color: #000;
  }
  #fstr_refresh__ {
    background-size: 15px 15px;
    height: 15px;
    width:  15px;
    z-index: 200;
  }
  #fstr_msg__ {
    left: 25px;
    z-index: 200;
    font-size: 0.8em;
  }

  body {
    background-color: white;
  }
</style>
<script src="https://cdn.socket.io/socket.io-1.3.4.js"></script>
<script>
(function () {
  console.log(">>> URL: "+document.URL)
  var green = 'url(http://i.imgur.com/Cp0ITNX.png)';
  var red   = 'url(http://i.imgur.com/WDddlnh.png)';
  var r = document.getElementById("fstr_refresh__");
  var m = document.getElementById("fstr_msg__");
  var refresh; // global to THIS script

  r.onclick = function() {
    return toggle();
  };

  var toggle = function() {
    if(r.style.backgroundImage === green) {
      // console.log("switch to red")
      r.style.backgroundImage = red;
      refresh = 'no'
    } else {
      // console.log("switch to green")
      r.style.backgroundImage = green;
      refresh = 'yes'
    }
    localStorage.setItem('fstr_refresh__', refresh)
    console.log("refresh: "+localStorage.getItem('fstr_refresh__'));
  }

  var boot = function(){
    refresh = localStorage.getItem('fstr_refresh__');
    console.log("boot refresh: "+refresh);
    if(refresh === 'yes') {
      r.style.backgroundImage = green; // set initial state
      m.innerHTML = localStorage.getItem('fstr_msg__');
    } else {
      r.style.backgroundImage = red;
    }
  }

  var socketInit = function() {
    var socket = io('http://localhost:4242');

    socket.on('message', function(data){
      console.log(data);
    })
    setInterval(function(){
      socket.emit('click', "Clicked "+ Math.random())
    }, 10000)

    socket.on('refresh', function(data) {
      m.innerHTML = data;
      // console.log(" >>>> " +data);
      localStorage.setItem('fstr_msg__', data);
      if(refresh === 'yes') {
        // console.log('refreshing content '+data);
        socket.disconnect()
        setTimeout(function(){
          // socket.emit('click', "CLIENT is Refreshing Browser Window");
          document.location.reload(true);
        },400)
      } else {
        console.log('refresh signal received: '+data);
      }
    })
  }

  var url = document.URL;
  if(url.search("localhost") > -1 || url.search('127.0') > -1) {
    socketInit();
    boot();
  }
}());
</script>
